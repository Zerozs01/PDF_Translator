# üèõÔ∏è MangaTranslate Rebirth Architecture

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞ Workflow ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏°‡∏µ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Edge Case ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

## 1. High-Level Architecture

‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏ö‡∏ö **Decoupled Service Layers** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å UI ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏ô‡∏±‡∏Å‡πÜ:

- **Renderer Process (React):** ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (UI/UX)
- **Vision Worker (Web Worker):** ‡∏£‡∏±‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• YOLOv8 ‡πÅ‡∏•‡∏∞ OpenCV.js ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥ Segmentation ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ UI ‡∏Ñ‡πâ‡∏≤‡∏á
- **OCR Worker (Web Worker):** ‡∏£‡∏±‡∏ô Tesseract.js ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ñ‡∏≠‡∏î‡∏£‡∏´‡∏±‡∏™‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
- **Main Process (Electron):** ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Gemini API (Secure Proxy)

## 2. Smart Segmentation V3 Pipeline (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏µ)

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏à‡∏±‡∏î "Ghost Regions" ‡∏ó‡∏µ‡πà‡∏ô‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏à‡∏≠ ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏û‡∏∂‡πà‡∏á‡∏û‡∏¥‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏• AI ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ **Hybrid Validation Pipeline**:

1.  **AI Detection (YOLOv8-seg):** - ‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏≤ "Candidate Regions" (Panel, Balloon, Text).
    - ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô Bounding Box ‡πÅ‡∏•‡∏∞ Confidence Score.
2.  **OpenCV Refinement (Contour Analysis):**
    - ‡∏ô‡∏≥ ROI ‡∏à‡∏≤‡∏Å YOLO ‡∏°‡∏≤‡∏ó‡∏≥ `thresholding` ‡πÅ‡∏•‡∏∞ `findContours` ‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏•.
    - **Filter Logic:** - ‡∏ñ‡πâ‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (Area) ‡πÄ‡∏•‡πá‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ -> ‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á.
        - ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏•‡∏™‡∏µ‡∏î‡∏≥ (Text density) -> ‡∏ï‡∏±‡∏î‡∏ó‡∏¥‡πâ‡∏á.
        - ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô (Overlap) -> ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö Z-index ‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö.
3.  **Stability System:** - ‡∏ô‡∏≥‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏°‡∏≤‡∏ó‡∏≥ "Non-Max Suppression" (NMS) ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏°‡∏±‡πà‡∏ß‡πÜ.

## 3. UI Shell: Zero-Edge Sidebar

‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏à‡∏∞‡πÉ‡∏ä‡πâ **CSS Grid + Framer Motion** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Sidebar ‡∏û‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏î‡πâ‡∏™‡∏ô‡∏¥‡∏ó 100%:

- **Layout Structure:**
    - `[Sidebar (0-250px)] | [Workspace (Flexible)]`
- **State Control:** - ‡πÉ‡∏ä‡πâ Zustand ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ `isSidebarOpen`. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î Sidebar ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà Workspace ‡∏à‡∏∞‡∏Ç‡∏¢‡∏≤‡∏¢ (Expand) ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ö‡∏ô Canvas ‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î.

## 4. State Management (Zustand Store)

‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÅ‡∏¢‡∏Å Store ‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 3 ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏•‡∏±‡∏Å:
1.  **`useProjectStore`**: ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PDF, ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤, ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î.
2.  **`useSegmentationStore`**: ‡πÄ‡∏Å‡πá‡∏ö Array ‡∏Ç‡∏≠‡∏á Regions (Panel, Text, etc.) ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà.
3.  **`useUIStore`**: ‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Sidebar, Zoom Level, ‡πÅ‡∏•‡∏∞ Active Tool.

## 5. Security & API

- **Gemini API Key:** ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô `.env` ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ú‡πà‡∏≤‡∏ô Electron Main Process ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡πÑ‡∏°‡πà Exposure ‡∏ó‡∏µ‡πà‡∏ù‡∏±‡πà‡∏á Frontend)
- **Context-Aware Prompting:** ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á Metadata ‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡πÄ‡∏ä‡πà‡∏ô "‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏°‡∏±‡∏á‡∏á‡∏∞‡πÅ‡∏ô‡∏ß‡∏ï‡∏•‡∏Å") ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Gemini ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î.